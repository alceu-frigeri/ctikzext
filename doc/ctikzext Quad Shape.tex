% !TEX program = pdflatex
% !TEX ext =  --interaction=nonstopmode --enable-etex --enable-write18
% !BIB program = none
\documentclass[a4paper, titlepage]{article}
\usepackage{a4wide}
%\usepackage[times]{mypacks}
\usepackage{etoolbox}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{xcolor}
\usepackage{codedescribe}
\parindent=0pt
\parskip=4pt plus 6pt minus 2pt
%
%\usepackage{pgf,tikz}
\usepackage[american,siunitx,cuteinductors,smartlabels,arrowmos,EFvoltages,betterproportions]{circuitikz}
\usetikzlibrary{math}
%%%\usepackage{pgffor}
%\usetikzlibrary{fit}
%\usetikzlibrary{calc}
%\usetikzlibrary{fpu}
%\usetikzlibrary{arrows,shapes}
%\usetikzlibrary{shapes.geometric} %needed for the triangle
%\usetikzlibrary{shapes.misc} %needed for the triangle

\usepackage{ctikzmanutils}

%\usepackage[noxtracmds]{ctikzext}
\usepackage{ctikzext}


\begin{document}

\section{Package Options}

As of now, just one:
\begin{describelist}{option}
\describe{noxtracmds}{This will suppress the definition of a few auxiliary commands. See \ref{auxcmds}.}
\end{describelist}

\subsection{Auxiliary Commands}\label{auxcmds}
Those are based on some ideas from Redaelli et al. (CircuiTiKz). Main differences: a variable number of parameters (see below) and it always also adds an empty node <coord>
\begin{codedescribe}{\showcoordstrue,\shoocoordsfalse}
\begin{codesyntax}%
\tsmacro{\showcoordstrue}{}
\tsmacro{\showcoordsfalse}{}
\end{codesyntax}
These will affect as the  \tsobj{\coord} will behave, with \tsobj{\showcoordstrue} a red pin will be added to the newly defined coordinate.
\end{codedescribe}

\begin{codedescribe}{\coord,\pincoord}
\begin{codesyntax}%
\tsobj{\coord}\tsargs[parg]{coord}
\tsobj{\pincoord}\tsverb{(}\tsobj[oarg,sep={,}]{coord}\tsverb{)}
\tsobj{\pincoord}\tsverb{(}\tsobj[oarg,sep={,}]{coord,color}\tsverb{)}
\tsobj{\pincoord}\tsverb{(}\tsobj[oarg,sep={,}]{coord,color,angle}\tsverb{)}
\tsobj{\pincoord}\tsverb{(}\tsobj[oarg,sep={,}]{coord,color,angle,distance}\tsverb{)}
\end{codesyntax}
The \tsobj{\coord} always expects a single parameter \tsobj[parg]{coord}. A coordinate and node with the same name will be created. If \tsobj{\showcoordstrue} is en force, it will also add a pin.

The \tsobj{\pincoord} expects from one to 4 parameters, as listed. If omitted, the default value for distance is 4 (unit: pt), the default value for the angle is -45 (degrees), the default value for color is blue.
In fact, the \tsobj{\coord(name)} is just a short cut for \tsverb{\pincoord(name,red,45)}, if \tsobj{\showcoordstrue}.
\end{codedescribe}



\section{Auxiliary Shapes and Basic Keys}
Those shapes are not intended for end users.

\subsection{Auxiliary shapes}\label{auxiliarynodes}
A set of auxiliary shapes are defined, but not meant to be used otherwise, though their anchors might be relevant:

\resizebox{0.26\textwidth}{!}{\geocoord[QuadKeys,generic]{H Res shape}}
\resizebox{0.26\textwidth}{!}{\geocoord[QuadKeys]{H Res shape}}
\resizebox{0.23\textwidth}{!}{\geocoord[QuadKeys,generic]{V Res shape}}
\resizebox{0.23\textwidth}{!}{\geocoord{V Res shape}}

\resizebox{0.23\textwidth}{!}{\geocoord[QuadKeys,round sources]{Vsource shape}}
\resizebox{0.23\textwidth}{!}{\geocoord{Vsource shape}}
\resizebox{0.23\textwidth}{!}{\geocoord[QuadKeys,round sources]{IsourceUP shape}}
\resizebox{0.23\textwidth}{!}{\geocoord{IsourceUP shape}}

\resizebox{0.23\textwidth}{!}{\geocoord[QuadKeys,round sources]{IsourceDOWN shape}}
\resizebox{0.23\textwidth}{!}{\geocoord{IsourceDOWN shape}}
\begin{tsremark}
The main point being that, regardless of the sub-shape orientation, the intuitive geographical coordinates applies.
\end{tsremark}


        
\subsection{General Keys}\label{generalkeys}
The following set of keys allow for shape fine tunning:
\begin{describelist*}[30mm]{keys}
  \describe {outer sep}  {Text outer separation, initial value: 1.5pt}
  \describe {inner sep}  {Text inner separation, initial value: 1pt}
  \describe {thickness} {Components thickness (relative to the drawing thickness), initial value: 2}
  \describe {tip len} {tip len (current source). initial value: 4pt}
  \describe {tip type} {possible values: \tsobj[keys]{triangle,bezier}. initial value: \tsobj[keys]{triangle}}
  \describe {minussign len}  {Minus sign len (voltage source). initial value: \tsobj{\pgf@circ@Rlen/14}}
  \describe {plussign len}  {Plus sign len (voltage source). initial value: \tsobj{1.1\pgf@circ@Rlen/14}}
  \describe {source radius} {The base radius. initial value: \tsobj{0.3\pgf@circ@Rlen}}
  \describe {round sources} {Sources will be round ones}
  \describe {control sources} {Sources will be control/diamond ones}
  \describe {generic, european} {Impedances will be generic rectangles}
  \describe {zigzag, american} {Impedances will be draw as zigzags}
\end{describelist*}
\begin{tsremark}
Those keys can be used with all the following components: \tsobj[meta]{Quad,Quad Z,Quad Y,Quad G,Quad H,ToQuad,ToQuad Z,ToQuad Y,ToQuad G,ToQuad H,Black Box,Thevenin,Norton,ToBlack Box,ToThevenin,ToNorton}.
\end{tsremark}



%  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}


\section{Z, Y, G, H Quadripoles}\label{quadanchors}
A set of configurable Quadripoles is defined, whereas quadripoles parameters (for instance $Z_{11}$, $Z_{12}$, $Z_{21}$ and $Z_{22}$) are <key-value> parameters.
\subsection{The Base Quadripole}
The base shape just draws a base box and sets some connection anchors: $1+$, $1-$, $inner\ 1+$, $inner\ 1-$, $2+$, $2-$, $inner\ 2+$ and $inner\ 2-$, besides the geographic ones:

\resizebox{0.53\textwidth}{!}{\geocoord{Quad}}
\resizebox{0.47\textwidth}{!}{\showanchors{Quad}{text}(1+/135/0.4, 1-/225/0.4, 2+/45/0.4, 2-/-45/0.4, inner 1+/-45/0.2, inner 1-/45/0.2, inner 2+/225/0.2, inner 2-/135/0.2)}

And also a set of (meant for) \emph{text} anchors:

\resizebox{0.65\textwidth}{!}{\showanchors{Quad}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}
        

\subsection{Customization keys}\label{quadkeys}
Additionally, one has:
\begin{describelist*}[30mm]{keys}
  \describe {base width}  {The 'box' width}
  \describe {half base width}  {Ditto, half width. Initial value:\tsobj{2\pgf@circ@Rlen}.}
  \describe {base height}  {The distance between \tsobj[keys]{1+,1-}. The 'box' full height is equal to 2*(\tsobj[keys]{half base height} + \tsobj[keys]{height ext} + \tsobj[keys]{height ext+}).}
  \describe {half base height} {Ditto, half height. Initial value:\tsobj{\pgf@circ@Rlen/7} }
  \describe {height ext}{Initial value:\tsobj{2\pgf@circ@Rlen/7}}
  \describe {height ext+}{Initial value:0}  
  \describe {inner ext} {distance between the 'box' and \tsobj{inner 1+/1-/2+/2-}. initial value: \tsobj{\pgf@circ@Rlen/7}}
  \describe {outer ext} {distance between the 'box' and \tsobj{1+/1-/2+/2-}. initial value: \tsobj{5\pgf@circ@Rlen/14}}
  \describe {inner marks}  {If set, the inner anchors will be marked.}
  \describe {outer marks}  {If set, the outer anchors will be marked.}
  \describe {invert} {The shape will be inverted, more or less like 'x scale=-1'.}
  \describe {alt, opt} {Case a Voltage source is zero, a series impedance will be draw vertically.}
  \describe {outer x fit to} {\tsobj[keys]{outer x fit=}\tsargs[marg]{CoordA,CoordB}. The width will be set so that \tsobj[meta]{1+,2+} (or \tsobj[meta]{1-,2-}, depending on the used anchor) will fit \tsobj[meta]{CoordA,CoordB}}
  \describe {inner x fit to} {\tsobj[keys]{inner x fit=}\tsargs[marg]{CoordA,CoordB}. The width will be set so that \tsobj[meta]{inner 1+,inner 2+} (or \tsobj[meta]{inner 1-,inner 2-}, depending on the used anchor) will fit \tsobj[meta]{CoordA,CoordB}}
  \describe {y fit to} {\tsobj[keys]{y fit=}\tsargs[marg]{CoordA,CoordB}. The distance between, lets say \tsobj[keys]{1+,1-} will be made equal to the distance between \tsobj[keys]{CoordA,CoordB}.}
\end{describelist*}
\begin{tsremark}
For Quadripoles, \tsobj[keys]{outer x fit, inner x fit} might result in a shape rotation. \tsobj[keys]{y fit} never will result in a rotation.
\end{tsremark}
\begin{tsremark}
Those keys can be used with all the following components: \tsobj[meta]{Quad,Quad Z,Quad Y,Quad G,Quad H,ToQuad,ToQuad Z,ToQuad Y,ToQuad G,ToQuad H,Black Box,Thevenin,Norton,ToBlack Box,ToThevenin,ToNorton}.
\end{tsremark}


A small example of the 'fit to' keys:
\begin{codestore}[QuadKeysA]
\begin{tikzpicture}
\draw (0,0) coordinate(A) \showcoord(A)<225:0.2> ++(4,0) coordinate(B) \showcoord(B)<-45:0.2> ++(2,2) coordinate(C)  \showcoord(C)<45:0.2> ;

\draw (A) node[Quad,anchor=1+,outer x fit to={A}{B}](Qa){\footnotesize$Qa$};
\draw (B) node[Quad,anchor=1+,outer x fit to={B}{C},I1=$I_a$,V2=$V_b$](Qb){\footnotesize$Qb$};

\draw (Qb.2-) -- ++(2,0) coordinate(D) \showcoord(D)<-90:0.2> ++(1,-2) coordinate(E) \showcoord(E)<-90:0.2>;

\draw (D) node[Black Box,anchor=1+,y fit to={D}{E}](Ba){\footnotesize$Ba$};

\draw (Qa.1-) ++(0,-1);
\end{tikzpicture}
\end{codestore}

\tsdemo*[emph={draw,node},basicstyle={\scriptsize\ttfamily},numbers=left]{QuadKeysA}


% show anchors of a node component:
% optional: options of the circuitikz environment
% mandatory  node spec, node text
% optional between (): anchor specification list
\NewDocumentCommand{\showsubanchors}{O{} m m m d()}
{
       \begin{circuitikz}[#1]
              \draw   (0,0) node[#2](N){#3};
            \IfValueT{#5}{%
                \foreach \sn in {#4} {%
                  \foreach \n/\a/\d in {#5} {%
                   \path (N-\sn.\n) \showcoord(\n)<\a:\d>;
                  }
                }
            }
            ;\par
        \end{circuitikz}%
}


\subsection{Quad}
This is just the base shape, to be used in cases whereas one just want to emphasises part of a circuit (using, for instance, the \tsobj[key]{inner x fit to} key, or just mark a two port black box.
\begin{tsremark}
There is also a \tsobj[key]{ToQuad} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{outer x fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.53\textwidth}{!}{\geocoord{Quad}}
\resizebox{0.47\textwidth}{!}{\showanchors{Quad}{text}(1+/135/0.4, 1-/225/0.4, 2+/45/0.4, 2-/-45/0.4, inner 1+/-45/0.2, inner 1-/45/0.2, inner 2+/225/0.2, inner 2-/135/0.2)}

\resizebox{0.65\textwidth}{!}{\showanchors{Quad}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}

\subsubsection{Quad Keys}
\begin{describelist*}{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{I2}{Initial value:\tsverb{$I_2$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{V2}{Initial value:\tsverb{$V_2$}}
\end{describelist*}


\subsubsection{Example of fit to uses}
Squeezing a Quadripole between two parts of a circuit (nodes C and D):

\begin{codestore}[QuadfitA]
\resizebox{0.4\textwidth}{!}{
\begin{tikzpicture}
  \draw (0,0) coordinate(ref) \showcoord(ref)<45:0.2> to[R=R1] ++(0,2) coordinate(A) \showcoord(A)<45:0.2>  to[R=R2] ++(0,2) coordinate(B) \showcoord(B)<45:0.2>
  -- ++(2,0) coordinate(C) \showcoord(C)<45:0.2> (C |- ref) coordinate(C1) \showcoord(C1)<45:0.2> -- (ref);
  \draw (C) ++(7,0)  coordinate(D) \showcoord(D)<45:0.2> -- ++(0.5,0) to[R=R3] ++(0,-3) -- ++(2,0) to[R=R4] ++(0,3) -- ++(0.5,0)  coordinate(E) \showcoord(E)<45:0.2>;
  \draw (C) node[Quad,anchor=1+,y fit to={C}{C1},outer x fit to={C}{D}]{};
\end{tikzpicture}}
\end{codestore}

\tsdemo*[emph={draw,node},emph2={x,y,fit,to,outer,inner,node},emph3={Quad,Black,Box},basicstyle={\scriptsize\ttfamily},numbers=left]{QuadfitA}

~

Fitting some circuit inside the Quadripole (nodes C and E):
\begin{codestore}[QuadfitB]
\resizebox{0.4\textwidth}{!}{
\begin{tikzpicture}
  \draw (0,0) coordinate(ref) \showcoord(ref)<45:0.2> to[R=R1] ++(0,2) coordinate(A) \showcoord(A)<45:0.2>  to[R=R2] ++(0,2) coordinate(B) \showcoord(B)<45:0.2>
  -- ++(2,0) coordinate(C) \showcoord(C)<45:0.2> (C |- ref) coordinate(C1) \showcoord(C1)<45:0.2> -- (ref);
  \draw (C) ++(7,0)  coordinate(D) \showcoord(D)<45:0.2> -- ++(0.5,0) to[R=R3] ++(0,-3) -- ++(2,0) to[R=R4] ++(0,3) -- ++(0.5,0)  coordinate(E) \showcoord(E)<45:0.2>;
  \draw (C) node[Quad,anchor=inner 1+,y fit to={C}{C1},inner x fit to={C}{E}]{};
\end{tikzpicture}}
\end{codestore}

\tsdemo*[emph={draw,node},emph2={x,y,fit,to,outer,inner,node},emph3={Quad,Black,Box},basicstyle={\scriptsize\ttfamily},numbers=left]{QuadfitB}



\subsection{Quad Z}
This shape, besides the base anchors (see \ref{quadanchors}) it has 4 internal nodes: \tsobj[key]{<node>-Z11,<node>-Z12,<node>-Z21,<node>-Z22}  and each of those sub-nodes has geographic anchors as defined at \ref{auxiliarynodes}.
\begin{tsremark}
There is also a \tsobj[key]{ToQuad Z} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{outer x fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.53\textwidth}{!}{\geocoord{Quad Z}}
\resizebox{0.47\textwidth}{!}{\showanchors{Quad Z}{text}(1+/135/0.4, 1-/225/0.4, 2+/45/0.4, 2-/-45/0.4, inner 1+/-45/0.2, inner 1-/45/0.2, inner 2+/225/0.2, inner 2-/135/0.2)}

\resizebox{0.65\textwidth}{!}{\showanchors{Quad Z}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}
\subsubsection{Quad Z keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{I2}{Initial value:\tsverb{$I_2$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{V2}{Initial value:\tsverb{$V_2$}}
  \describe{Z11}{Initial value:\tsverb{$Z_{11}$}}
  \describe{Z12}{Initial value:\tsverb{$Z_{12}$}}
  \describe{Z21}{Initial value:\tsverb{$Z_{21}$}}
  \describe{Z22}{Initial value:\tsverb{$Z_{22}$}}
  \describe{Z11 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south west}{top left}}}
  \describe{Z12 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top left}}}
  \describe{Z21 label pos}{changes the label position. Defaults to: \tsobj[verb]{{north west}{bottom right}}}
  \describe{Z22 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top right}}}
\end{describelist*}
\begin{tsremark}
The label pos keys expects two anchor names (... label pos=\tsargs[marg]{anchor A,anchor B}). The first anchors refers the sub-shape node and the second anchor is the text one.
\end{tsremark}



\subsection{Quad Y}
This shape, besides the base anchors (see \ref{quadanchors}) it has 4 internal nodes: \tsobj[key]{<node>-Y11,<node>-Y12,<node>-Y21,<node>-Y22}  and each of those sub-nodes has geographic anchors as defined at \ref{auxiliarynodes}.
\begin{tsremark}
There is also a \tsobj[key]{ToQuad Y} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{outer x fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.53\textwidth}{!}{\geocoord{Quad Y}}
\resizebox{0.47\textwidth}{!}{\showanchors{Quad Y}{text}(1+/135/0.4, 1-/225/0.4, 2+/45/0.4, 2-/-45/0.4, inner 1+/-45/0.2, inner 1-/45/0.2, inner 2+/225/0.2, inner 2-/135/0.2)}

\resizebox{0.65\textwidth}{!}{\showanchors{Quad Y}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}

\subsubsection{Quad Y keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{I2}{Initial value:\tsverb{$I_2$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{V2}{Initial value:\tsverb{$V_2$}}
  \describe{Y11}{Initial value:\tsverb{$Y_{11}$}}
  \describe{Y12}{Initial value:\tsverb{$Y_{12}$}}
  \describe{Y21}{Initial value:\tsverb{$Y_{21}$}}
  \describe{Y22}{Initial value:\tsverb{$Y_{22}$}}
  \describe{Y11 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south west}{top left}}}
  \describe{Y12 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top left}}}
  \describe{Y21 label pos}{changes the label position. Defaults to: \tsobj[verb]{{north west}{bottom right}}}
  \describe{Y22 label pos}{changes the label position. Defaults to: \tsobj[verb]{{north west}{bottom right}}}
\end{describelist*}
\begin{tsremark}
The label pos keys expects two anchor names (... label pos=\tsargs[marg]{anchor A,anchor B}). The first anchors refers the sub-shape node and the second anchor is the text one.
\end{tsremark}

\subsection{Quad G}
This shape, besides the base anchors (see \ref{quadanchors}) it has 4 internal nodes: \tsobj[key]{<node>-G11,<node>-G12,<node>-G21,<node>-G22}  and each of those sub-nodes has geographic anchors as defined at \ref{auxiliarynodes}.
\begin{tsremark}
There is also a \tsobj[key]{ToQuad G} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{outer x fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.53\textwidth}{!}{\geocoord{Quad G}}
\resizebox{0.47\textwidth}{!}{\showanchors{Quad G}{text}(1+/135/0.4, 1-/225/0.4, 2+/45/0.4, 2-/-45/0.4, inner 1+/-45/0.2, inner 1-/45/0.2, inner 2+/225/0.2, inner 2-/135/0.2)}

\resizebox{0.65\textwidth}{!}{\showanchors{Quad G}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}

\subsubsection{Quad G keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{I2}{Initial value:\tsverb{$I_2$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{V2}{Initial value:\tsverb{$V_2$}}
  \describe{G11}{Initial value:\tsverb{$G_{11}$}}
  \describe{G12}{Initial value:\tsverb{$G_{12}$}}
  \describe{G21}{Initial value:\tsverb{$G_{21}$}}
  \describe{G22}{Initial value:\tsverb{$G_{22}$}}
  \describe{G11 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south west}{top left}}}
  \describe{G12 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top left}}}
  \describe{G21 label pos}{changes the label position. Defaults to: \tsobj[verb]{{north west}{bottom right}}}
  \describe{G22 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top right}}}  
\end{describelist*}
\begin{tsremark}
The label pos keys expects two anchor names (... label pos=\tsargs[marg]{anchor A,anchor B}). The first anchors refers the sub-shape node and the second anchor is the text one.
\end{tsremark}

\subsection{Quad H}
This shape, besides the base anchors (see \ref{quadanchors}) it has 4 internal nodes: \tsobj[key]{<node>-H11,<node>-H12,<node>-H21,<node>-H22}  and each of those sub-nodes has geographic anchors as defined at \ref{auxiliarynodes}.
\begin{tsremark}
There is also a \tsobj[key]{ToQuad H} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{outer x fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.53\textwidth}{!}{\geocoord{Quad H}}
\resizebox{0.47\textwidth}{!}{\showanchors{Quad H}{text}(1+/135/0.4, 1-/225/0.4, 2+/45/0.4, 2-/-45/0.4, inner 1+/-45/0.2, inner 1-/45/0.2, inner 2+/225/0.2, inner 2-/135/0.2)}

\resizebox{0.65\textwidth}{!}{\showanchors{Quad H}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}


\subsubsection{Quad H keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{I2}{Initial value:\tsverb{$I_2$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{V2}{Initial value:\tsverb{$V_2$}}
  \describe{H11}{Initial value:\tsverb{$H_{11}$}}
  \describe{H12}{Initial value:\tsverb{$H_{12}$}}
  \describe{H21}{Initial value:\tsverb{$H_{21}$}}
  \describe{H22}{Initial value:\tsverb{$H_{22}$}}
  \describe{H11 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south west}{top left}}}
  \describe{H12 label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top left}}} 
  \describe{H21 label pos}{changes the label position. Defaults to: \tsobj[verb]{{north west}{bottom right}}}
  \describe{H22 label pos}{changes the label position. Defaults to: \tsobj[verb]{{north west}{bottom right}}}
\end{describelist*}

\begin{tsremark}
The label pos keys expects two anchor names (... label pos=\tsargs[marg]{anchor A,anchor B}). The first anchors refers the sub-shape node and the second anchor is the text one.
\end{tsremark}


\section{Thevenin, Norton single port dipoles}


\subsection{The Base Black Box}\label{BBanchors}

The base shape just draws a base box and sets some connection anchors: $1+$, $1-$, $inner\ 1+$, $inner\ 1-$, besides the geographic and text ones:

\resizebox{0.33\textwidth}{!}{\geocoord{Black Box}}
\resizebox{0.22\textwidth}{!}{\showanchors{Black Box}{text}(1+/135/0.4, 1-/225/0.4, inner 1+/-45/0.2, inner 1-/45/0.2)}
\resizebox{0.42\textwidth}{!}{\showanchors{Black Box}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}
        
~   

\subsection{Customization keys}\label{BBkeys}

Additionally, one has:

\begin{describelist*}[30mm]{keys}
  \describe {base width}  {The 'box' width}
  \describe {half base width}  {Ditto, half width. Initial value:\tsobj{2\pgf@circ@Rlen}.}
  \describe {base height}  {The distance between \tsobj[keys]{1+,1-}. The 'box' full height is equal to 2*(\tsobj[keys]{half base height} + \tsobj[keys]{height ext} + \tsobj[keys]{height ext+}).}
  \describe {half base height} {Ditto, half height. Initial value:\tsobj{\pgf@circ@Rlen/7} }
  \describe {height ext}{Initial value:\tsobj{2\pgf@circ@Rlen/7}}
  \describe {height ext+}{Initial value:0}  
  \describe {inner ext} {distance between the 'box' and \tsobj{inner 1+/1-/2+/2-}. initial value: \tsobj{\pgf@circ@Rlen/7}}
  \describe {outer ext} {distance between the 'box' and \tsobj{1+/1-/2+/2-}. initial value: \tsobj{5\pgf@circ@Rlen/14}}
  \describe {inner marks}  {If set, the inner anchors will be marked.}
  \describe {outer marks}  {If set, the outer anchors will be marked.}
  \describe {invert} {The shape will be inverted, more or less like 'x scale=-1'.}
  \describe {alt, opt} {Case a Voltage source is zero, a series impedance will be draw vertically.}
  \describe {outer x fit to} {\tsobj[keys]{outer x fit=}\tsargs[marg]{CoordA,CoordB}. The width will be set so that the distance between \tsobj[meta]{1+,2+} (or \tsobj[meta]{1-,2-}, depending on the used anchor) will be the same as \tsobj[meta]{CoordA,CoordB}.}
  \describe {inner x fit to} {\tsobj[keys]{inner x fit=}\tsargs[marg]{CoordA,CoordB}. The width will be set so that the distance between \tsobj[meta]{inner 1+,inner 2+} (or \tsobj[meta]{inner 1-,inner 2-}, depending on the used anchor) will be the same as \tsobj[meta]{CoordA,CoordB}}
  \describe {y fit to} {\tsobj[keys]{y fit=}\tsargs[marg]{CoordA,CoordB}.  \tsobj[keys]{1+,1-} will fit \tsobj[keys]{CoordA,CoordB} respectively.}
\end{describelist*}

\begin{tsremark}
For a Thevenin/Norton/Black Box, \tsobj[keys]{outer x fit, inner x fit} will never result in a shape rotation. \tsobj[keys]{y fit}   might result in a shape rotation.
\end{tsremark}
\begin{tsremark}
Those keys can be used with all the following components: \tsobj[meta]{Quad,Quad Z,Quad Y,Quad G,Quad H,ToQuad,ToQuad Z,ToQuad Y,ToQuad G,ToQuad H,Black Box,Thevenin,Norton,ToBlack Box,ToThevenin,ToNorton}.
\end{tsremark}


        
\subsection{Black Box, BB}
This is just the base shape, to be used in cases whereas one just want to emphasises part of a circuit (using, for instance, the \tsobj[key]{inner x fit to} key, or just mark a single port black box.
\begin{tsremark}
There is also a \tsobj[key]{ToBlack Box} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{y fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.33\textwidth}{!}{\geocoord{Black Box}}
\resizebox{0.18\textwidth}{!}{\showanchors{Black Box}{text}(1+/135/0.4, 1-/225/0.4, inner 1+/-45/0.2, inner 1-/45/0.2)}
\resizebox{0.43\textwidth}{!}{\showanchors{Black Box}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}

\subsubsection{Black Box keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
\end{describelist*}

\subsection{Example of fit to uses}
Squeezing a Black Box between two parts of a circuit (nodes C and D):

\begin{codestore}[BBfitA]
\resizebox{0.4\textwidth}{!}{
\begin{tikzpicture}
  \draw (0,0) coordinate(ref) \showcoord(ref)<45:0.2> to[R=R1] ++(0,2) coordinate(A) \showcoord(A)<45:0.2>  to[R=R2] ++(0,2) coordinate(B) \showcoord(B)<45:0.2>
  -- ++(2,0) coordinate(C) \showcoord(C)<45:0.2> (C |- ref) coordinate(C1) \showcoord(C1)<45:0.2> -- (ref);
  \draw (C) ++(7,0)  coordinate(D) \showcoord(D)<45:0.2> -- ++(0.5,0) to[R=R3] ++(0,-3) -- ++(2,0) to[R=R4] ++(0,3) -- ++(0.5,0)  coordinate(E) \showcoord(E)<45:0.2>;
  \draw (C) node[Black Box,anchor=1+,y fit to={C}{C1},outer x fit to={C}{D}]{};
\end{tikzpicture}
}
\end{codestore}

\tsdemo*[emph={draw,node},emph2={x,y,fit,to,outer,inner,node},emph3={Quad,Black,Box},basicstyle={\scriptsize\ttfamily},numbers=left]{BBfitA}

~

Fitting some circuit inside the Black Box (nodes C and E):
\begin{codestore}[BBfitB]
\resizebox{0.4\textwidth}{!}{
\begin{tikzpicture}
  \draw (0,0) coordinate(ref) \showcoord(ref)<45:0.2> to[R=R1] ++(0,2) coordinate(A) \showcoord(A)<45:0.2>  to[R=R2] ++(0,2) coordinate(B) \showcoord(B)<45:0.2>
  -- ++(2,0) coordinate(C) \showcoord(C)<45:0.2> (C |- ref) coordinate(C1) \showcoord(C1)<45:0.2> -- (ref);
  \draw (C) ++(7,0)  coordinate(D) \showcoord(D)<45:0.2> -- ++(0.5,0) to[R=R3] ++(0,-3) -- ++(2,0) to[R=R4] ++(0,3) -- ++(0.5,0)  coordinate(E) \showcoord(E)<45:0.2>;
  \draw (C) node[Black Box,anchor=inner 1+,y fit to={C}{C1},inner x fit to={C}{E}]{};
\end{tikzpicture}
}
\end{codestore}

\tsdemo*[emph={draw,node},emph2={x,y,fit,to,outer,inner,node},emph3={Quad,Black,Box},basicstyle={\scriptsize\ttfamily},numbers=left]{BBfitB}


\subsection{Thevenin}
This is the classical Thevenin circuit. Besides the base anchors (see \ref{BBanchors}) it has 2 internal nodes: \tsobj[key]{<node>-Zth,<node>-Vth}  and each of those sub-nodes has geographic anchors as defined at \ref{auxiliarynodes}.
\begin{tsremark}
There is also a \tsobj[key]{ToThevenin} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{y fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.33\textwidth}{!}{\geocoord{Thevenin}}
\resizebox{0.18\textwidth}{!}{\showanchors{Thevenin}{text}(1+/135/0.4, 1-/225/0.4, inner 1+/-45/0.2, inner 1-/45/0.2)}
\resizebox{0.43\textwidth}{!}{\showanchors{Thevenin}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}


\subsubsection{Thevenin keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{Zth}{Initial value:\tsverb{$Z_{th}$}}
  \describe{Vth}{Initial value:\tsverb{$V_{th}$}}
  \describe{Zth label pos}{changes the label position. Defaults to: \tsobj[verb]{{south west}{top left}}}
  \describe{Vth label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top left}}} 
\end{describelist*}
\begin{tsremark}
The label pos keys expects two anchor names (... label pos=\tsargs[marg]{anchor A,anchor B}). The first anchors refers the sub-shape node and the second anchor is the text one.
\end{tsremark}

\subsection{Norton}
This is the classical Norton circuit. Besides the base anchors (see \ref{BBanchors}) it has 2 internal nodes: \tsobj[key]{<node>-Yn,<node>-In}  and each of those sub-nodes has geographic anchors as defined at \ref{auxiliarynodes}.
\begin{tsremark}
There is also a \tsobj[key]{ToNorton} to be used in a \tsobj[key]{to[ ]} path, in which case the key \tsobj[key]{y fit to} style will be triggered with the starting and ending points of the \tsobj[key]{to[ ]} path.
\end{tsremark}

\resizebox{0.33\textwidth}{!}{\geocoord{Norton}}
\resizebox{0.18\textwidth}{!}{\showanchors{Norton}{text}(1+/135/0.4, 1-/225/0.4, inner 1+/-45/0.2, inner 1-/45/0.2)}
\resizebox{0.43\textwidth}{!}{\showanchors{Norton}{text}(
        bottom left/225/0.4, bottom center/-90/0.4, bottom right/-45/0.4, 
        near bottom left/225/0.4, near bottom center/90/0.2, near bottom right/-45/0.4,
        top left/135/0.4, top center/90/0.4, top right/45/0.4, 
        near top left/135/0.4, near top center/-90/0.2, near top right/45/0.4
        )}

\subsubsection{Norton keys}
\begin{describelist*}[30mm]{keys}
  \describe {name}  {\tsmeta{node-name}, when using a to[\,] path.}
  \describe{I1}{Initial value:\tsverb{$I_1$}}
  \describe{V1}{Initial value:\tsverb{$V_1$}}
  \describe{Yn}{Initial value:\tsverb{$Y_{N}$}}
  \describe{In}{Initial value:\tsverb{$I_{N}$}}
  \describe{Yn label pos}{changes the label position. Defaults to: \tsobj[verb]{{south west}{top left}}}
  \describe{In label pos}{changes the label position. Defaults to: \tsobj[verb]{{south east}{top left}}}
\end{describelist*}
\begin{tsremark}
The label pos keys expects two anchor names (... label pos=\tsargs[marg]{anchor A,anchor B}). The first anchors refers the sub-shape node and the second anchor is the text one.
\end{tsremark}

\end{document}
